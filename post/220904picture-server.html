

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/Ficon.png">
  <link rel="icon" href="/img/Ficon.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#ff9016">
  <meta name="author" content="TT2TER">
  <meta name="keywords" content="c">
  
    <meta name="description" content="之前图床都不好用了，为了可持续发展，决定自建图床">
<meta property="og:type" content="article">
<meta property="og:title" content="用仅ipv6vps自建图床并支持ipv4访问">
<meta property="og:url" content="http://blog.1314171.xyz/post/220904picture-server.html">
<meta property="og:site_name" content="马火星的迷你小屋">
<meta property="og:description" content="之前图床都不好用了，为了可持续发展，决定自建图床">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://pic.1314171.xyz/i/2022/10/19/634fe03aafd19.jpg">
<meta property="og:image" content="https://pic.1314171.xyz/i/2022/10/19/634fe0e22b95f.jpg">
<meta property="og:image" content="https://pic.1314171.xyz/i/2022/10/19/634fdfd8c3390.png">
<meta property="og:image" content="https://pic.1314171.xyz/i/2022/10/19/634fde242e29d.png">
<meta property="og:image" content="https://pic.1314171.xyz/i/2022/10/19/634fe15f4b80c.jpg">
<meta property="og:image" content="https://pic.1314171.xyz/i/2022/10/19/634fe138d9bc5.png">
<meta property="og:image" content="https://pic.1314171.xyz/i/2022/10/19/634fe105c8f1c.png">
<meta property="article:published_time" content="2022-09-05T15:33:30.000Z">
<meta property="article:modified_time" content="2022-10-19T11:44:27.277Z">
<meta property="article:author" content="TT2TER">
<meta property="article:tag" content="vscode">
<meta property="article:tag" content="blog">
<meta property="article:tag" content="vps">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://pic.1314171.xyz/i/2022/10/19/634fe03aafd19.jpg">
  
  
  
  <title>用仅ipv6vps自建图床并支持ipv4访问 - 马火星的迷你小屋</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  



  
<link rel="stylesheet" href="/css/custom.css">



  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"blog.1314171.xyz","root":"/","version":"1.9.2","typing":{"enable":true,"typeSpeed":60,"cursorChar":"(๑•̀ㅂ•́)و ","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":"§"},"progressbar":{"enable":true,"height_px":3,"color":"#ff9900","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":2},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":true,"follow_dnt":true,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":"aB3ynsgfc1O2zRMzmqglwTX5-MdYXbMMI","app_key":"VhQBw7fQ504qfdMESXidgP6C","server_url":null,"path":"window.location.pathname","ignore_local":true}},"search_path":"/local-search.xml"};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  

  

  

  

  

  

  

  
    
  



  
<meta name="generator" content="Hexo 6.2.0"><link rel="alternate" href="/atom.xml" title="马火星的迷你小屋" type="application/atom+xml">
</head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>马火星</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" target="_self" href="javascript:;" role="button"
                 data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <i class="iconfont icon-pen"></i>
                文章
              </a>
              <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                
                  
                  
                  
                  <a class="dropdown-item" href="/archives/">
                    <i class="iconfont icon-archive-fill"></i>
                    归档
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/categories/">
                    <i class="iconfont icon-category-fill"></i>
                    分类
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/tags/">
                    <i class="iconfont icon-tags-fill"></i>
                    标签
                  </a>
                
              </div>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                关于
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/">
                <i class="iconfont icon-link-fill"></i>
                友链
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/atom.xml">
                <i class="iconfont icon-rss-fill"></i>
                
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              &nbsp;<i class="iconfont icon-search"></i>&nbsp;
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/Beijing.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="用仅ipv6vps自建图床并支持ipv4访问"></span>
          
        </div>

        
          
  <div class="mt-3">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-author" aria-hidden="true"></i>
        TT2TER
      </span>
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2022-09-05 23:33" pubdate>
          2022年9月5日 晚上
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          <!-- compatible with older versions-->
          3.9k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          <!-- compatible with older versions-->
          13 分钟
        
      </span>
    

    
    
      
        <span id="leancloud-page-views-container" class="post-meta" style="display: none">
          <i class="iconfont icon-eye" aria-hidden="true"></i>
          <span id="leancloud-page-views"></span> 次
        </span>
        
      
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">用仅ipv6vps自建图床并支持ipv4访问</h1>
            
            
              <div class="markdown-body">
                
                <p>221019更新，图床已支持https且仅支持https</p>
<h1 id="换图床的原因"><a href="#换图床的原因" class="headerlink" title="换图床的原因"></a>换图床的原因</h1><p>之前sm.ms图床已经不太能用而且有审核，已经无故挂了我三张图片了</p>
<p>后来github图床的解决方案因为jsdelivr的cdn加速在国内被墙：</p>
<p><a target="_blank" rel="noopener" href="https://luotianyi.vc/6295.html">致敬-被滥用的jsdelivr,我又何尝不是其中一员呢？</a></p>
<p>干脆直接换个较大硬盘的vps</p>
<p>简单搜索之后发现方案可行，基本上随便一搜就20欧10G千兆带宽</p>
<h1 id="选择主机商"><a href="#选择主机商" class="headerlink" title="选择主机商"></a>选择主机商</h1><p><del>舍友推荐了个便宜的主机商：</del></p>
<h2 id="221019更新：请考虑别的主机，该机型已无库存"><a href="#221019更新：请考虑别的主机，该机型已无库存" class="headerlink" title="221019更新：请考虑别的主机，该机型已无库存"></a>221019更新：请考虑别的主机，该机型已无库存</h2><p><a target="_blank" rel="noopener" href="https://my.server-factory.com/">server-factory</a></p>
<p>仅ipv6主机仅需6欧，nat主机9欧一年，而且支持Alipay（支付宝）<br><img src="https://pic.1314171.xyz/i/2022/10/19/634fe03aafd19.jpg" srcset="/img/loading.gif" lazyload alt="测速图片"></p>
<p>要什么自行车，冲他<br><img src="https://pic.1314171.xyz/i/2022/10/19/634fe0e22b95f.jpg" srcset="/img/loading.gif" lazyload alt="购买这个就行"></p>
<p><del>买这个仅Ipv6就行</del>，解决ipv4访问用cf cdn套一层代理</p>
<p>确保用cf代理，小云朵打开即可</p>
<h2 id="申请证书"><a href="#申请证书" class="headerlink" title="申请证书"></a>申请证书</h2><p>之前用脚本在vps上申请证书的时候不能套上述小云朵，否则会失败或者替cf申请证书……</p>
<p>这次尝试直接套小云朵嫖cf证书</p>
<h3 id="221001更新"><a href="#221001更新" class="headerlink" title="221001更新"></a>221001更新</h3><p><img src="https://pic.1314171.xyz/i/2022/10/19/634fdfd8c3390.png" srcset="/img/loading.gif" lazyload></p>
<p>如果要加证书在获取token时就如下图所示<br><img src="https://pic.1314171.xyz/i/2022/10/19/634fde242e29d.png" srcset="/img/loading.gif" lazyload></p>
<p>申请cf证书请参考：<a target="_blank" rel="noopener" href="https://65536.io/2020/03/607.html">博客</a></p>
<h1 id="选择图床"><a href="#选择图床" class="headerlink" title="选择图床"></a>选择图床</h1><p>大概有三个很好的选择，<a target="_blank" rel="noopener" href="https://www.lsky.pro/">兰空图床</a>、<a target="_blank" rel="noopener" href="https://github.com/helloxz/imgurl">imgurl</a>和<a target="_blank" rel="noopener" href="https://chevereto.com/">chevereto</a></p>
<p>最后选择兰空的原因是：imgurl社区开源版本上次更新已经过去三年了，<a target="_blank" rel="noopener" href="https://github.com/chevereto/vps">chevereto</a>令人望而生畏的英文文档(而且只有付费版了，还不便宜，以及，我以为兰空有中文文档很好搭建，官方宣传：半小时搭好，文档写的不好，但照着我这个教程10分钟ko)</p>
<h1 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h1><h3 id="主要参考资料"><a href="#主要参考资料" class="headerlink" title="主要参考资料"></a>主要参考资料</h3><p>非常感谢</p>
<ol>
<li><p><a target="_blank" rel="noopener" href="https://www.zatp.com/post/lsky-pro-image-hosting/">搭建 Lsky Pro 兰空图床</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/Bacon_Fish/article/details/125681902">兰空图床搭建</a></p>
</li>
</ol>
<h2 id="为啥不用宝塔面板"><a href="#为啥不用宝塔面板" class="headerlink" title="为啥不用宝塔面板"></a>为啥不用宝塔面板</h2><p>毕竟1G的机子跑宝塔完全没问题</p>
<p>但</p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/196684686">宝塔面板爆重大漏洞，数据库无鉴权直接访问</a></p>
<p>在舍友的极力劝阻下我开始了我的苦闷的从0开始之旅</p>
<h2 id="没头苍蝇阶段"><a href="#没头苍蝇阶段" class="headerlink" title="没头苍蝇阶段"></a>没头苍蝇阶段</h2><p>所谓的半小时，我整了整整一天。</p>
<p>一开始按照中文文档搭建，几乎没任何指导，并且有nginx和php两大知识盲区，后来……</p>
<p>痛苦</p>
<p>直到我找到了上面引用的第2篇教程</p>
<h2 id="安装Nginx"><a href="#安装Nginx" class="headerlink" title="安装Nginx"></a>安装Nginx</h2><p>参阅<a target="_blank" rel="noopener" href="https://docs.nginx.com/nginx/admin-guide/installing-nginx/installing-nginx-open-source/">官方文档</a>后</p>
<p>决定直接apt安装</p>
<p>以下均root用户命令</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">apt update<br>apt upgrade<br>apt install nginx<br><span class="hljs-comment">#查询其工作状态</span><br>systemctl status nginx<br></code></pre></td></tr></table></figure>
<p>在浏览器内输入您的IP地址或域名并打开</p>
<p>显示：<br><img src="https://pic.1314171.xyz/i/2022/10/19/634fe15f4b80c.jpg" srcset="/img/loading.gif" lazyload><br>说明Nginx已经正常工作</p>
<h2 id="安装PHP"><a href="#安装PHP" class="headerlink" title="安装PHP"></a>安装PHP</h2><p>根据官方的文档，要满足如下要求</p>
<pre><code class="hljs">PHP &gt;= 8.0.2
BCMath PHP 扩展
Ctype PHP 扩展
DOM PHP 拓展
Fileinfo PHP 扩展
JSON PHP 扩展
Mbstring PHP 扩展
OpenSSL PHP 扩展
PDO PHP 扩展
Tokenizer PHP 扩展
XML PHP 扩展
Imagick 拓展
exec、shell_exec 函数
readlink、symlink 函数
putenv、getenv 函数
chmod、chown、fileperms 函数
</code></pre>
<p>有些头大<br>最后整理出来的安装命令如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs bash">curl -sSL https://packages.sury.org/php/README.txt | bash -x<br><br><span class="hljs-comment">#上述脚本内容为:</span><br><span class="hljs-comment">#!/bin/sh</span><br><span class="hljs-comment"># To add this repository please do:</span><br><br><span class="hljs-comment">#if [ &quot;$(whoami)&quot; != &quot;root&quot; ]; then</span><br><span class="hljs-comment">#    SUDO=sudo</span><br><span class="hljs-comment">#fi</span><br><br><span class="hljs-comment">#$&#123;SUDO&#125; apt-get update</span><br><span class="hljs-comment">#$&#123;SUDO&#125; apt-get -y install apt-transport-https lsb-release ca-certificates curl</span><br><span class="hljs-comment">#$&#123;SUDO&#125; curl -sSLo /usr/share/keyrings/deb.sury.org-php.gpg https://packages.sury.org/php/apt.gpg</span><br><span class="hljs-comment">#$&#123;SUDO&#125; sh -c &#x27;echo &quot;deb [signed-by=/usr/share/keyrings/deb.sury.org-php.gpg] https://packages.sury.org/php/ $(lsb_release -sc) main&quot; &gt; /etc/apt/sources.list.d/php.list&#x27;</span><br><span class="hljs-comment">#$&#123;SUDO&#125; apt-get update</span><br><br><span class="hljs-comment"># 这里安装8.1版本</span><br>apt install -y php8.1 php8.1-cli php8.1-common php8.1-fpm php8.1-xml php8.1-curl php8.1-mysql php8.1-sqlite3 php8.1-mbstring php8.1-gd php8.1-fileinfo php8.1-exif php8.1-bcmath php8.1-imagick php8.1-opcache php8.1-readline php8.1-dom php8.1-tokenizer<br><br>apt install libssl-dev openssl<br></code></pre></td></tr></table></figure>

<p>上述脚本将官方源添加到apt中，apt install完成了所有依赖的安装。</p>
<h2 id="配置PHP"><a href="#配置PHP" class="headerlink" title="配置PHP"></a>配置PHP</h2><p>打开php.ini，示例命令</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">vim /etc/php/8.1/fpm/php.ini<br><span class="hljs-comment">#注意路径中的8.1改成您安装的对应版本号</span><br></code></pre></td></tr></table></figure>

<p>在其中找到如下几点：</p>
<ol>
<li>找到<code>disable_functions</code>，若 “&#x3D;” 右侧存在<code>exec、shell_exec、readlink、symlink、putenv、getenv</code>函数，将其删除（默认状态下，等号右侧为空白）；</li>
<li>找到<code>memory_limit</code>，根据机器配置适当调大 “&#x3D;” 右侧最大内存大小（默认php128mb内存）；</li>
<li>找到<code>post_max_size</code>，适当调大 “&#x3D;” 右侧POST方法所能传输数据的最大大小（这是队列大小，调整为想上传最大单个文件大小乘上想一次性上传图片数）；</li>
<li>找到<code>upload_max_filesize</code>，适当调大 “&#x3D;” 右侧最大文件上传大小（这是单个文件上传大小）；</li>
<li><code>max_execution_time</code> 右侧为最大执行时间，默认为30秒，也就是说如果上传超过 30 秒，该队列就会停止</li>
<li>找到<code>open_basedir</code>，在其前面加上“;”（默认已添加）。</li>
</ol>
<p>重启php-fpm并检查工作状态</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">systemctl restart php8.1-fpm<br><span class="hljs-comment">#根据安装版本调整版本号</span><br>systemctl status php8.1-fpm<br><span class="hljs-comment">#根据安装版本调整版本号</span><br></code></pre></td></tr></table></figure>

<h2 id="安装兰空图床本体"><a href="#安装兰空图床本体" class="headerlink" title="安装兰空图床本体"></a>安装兰空图床本体</h2><ol>
<li>下载源码：<br>从<a target="_blank" rel="noopener" href="https://github.com/lsky-org/lsky-pro/releases">release</a>下载最新安装包，放在你想安装的路径上</li>
</ol>
<p>这里以 <code>/home/www/lsky</code> 路径举例</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#首先安装解压</span><br>apt install unzip<br><span class="hljs-comment"># 下一句注意修改版本号</span><br>unzip -d /home/www/lsky/ lsky-pro-2.1.zip<br><span class="hljs-comment">#将安装文件夹及其子文件夹权限设为755，所有者改为www-data：</span><br><span class="hljs-built_in">chmod</span> -R 755 /home/www/lsky<br><span class="hljs-built_in">chown</span> -R www-data /home/www/lsky<br></code></pre></td></tr></table></figure>
<h2 id="配置Nginx和PHP协同"><a href="#配置Nginx和PHP协同" class="headerlink" title="配置Nginx和PHP协同"></a>配置Nginx和PHP协同</h2><p>打开default网站配置文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">vim /etc/nginx/sites-available/default<br></code></pre></td></tr></table></figure>
<p>将内容复制到<br><code>/etc/nginx/cinf.d</code>下新建一文件命名为：<code>lsky.conf</code></p>
<p>修改其中<br>0. 去除掉80端口后的 default……</p>
<ol>
<li>转到server块，找到root项，将其后的路径指向Lsky Pro安装路径的public文件夹；</li>
<li>找到index项，在其后添加index.php；</li>
<li>找到server_name项，将其后的内容改为您的IP或域名；</li>
<li>转到location &#x2F; 块，找到try_files项，将 &#x3D;404 改为 &#x2F;index.php?$query_string（即设置伪静态）；</li>
<li>转到location ~ .php$块，去除行前#号，选择With php-fpm方法，将路径中的PHP版本修改为对应安装版本。修改完的效果应如图所示：</li>
</ol>
<p><img src="https://pic.1314171.xyz/i/2022/10/19/634fe138d9bc5.png" srcset="/img/loading.gif" lazyload></p>
<p>执行以下命令打开Nginx配置文档：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">vim /etc/nginx/nginx.conf<br></code></pre></td></tr></table></figure>
<p>在http块中添加</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs json">client_max_body_size <span class="hljs-number">25</span>m;<br>#<span class="hljs-number">25</span>m为Nginx限制的一次性上传文件最大大小<br>#大小可视情况调整<br></code></pre></td></tr></table></figure>

<p>检查配置有无错误，重启</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">nginx -t<br><span class="hljs-comment">#若无错误</span><br>systemctl restart nginx<br></code></pre></td></tr></table></figure>
<h2 id="安装数据库"><a href="#安装数据库" class="headerlink" title="安装数据库"></a>安装数据库</h2><p>尝试安装MySQL</p>
<p>但官方源始终无法curl到，我也懒得整了</p>
<p>就用SQLite，简单不用安装</p>
<h2 id="初始化图床"><a href="#初始化图床" class="headerlink" title="初始化图床"></a>初始化图床</h2><p>配置好域名以后，访问站点首页，程序会自动跳转至安装页面，环境检测通过以后即可通过引导进行安装。</p>
<p><code>数据库名称/路径</code>留空即可</p>
<h2 id="接入api和picgo协同"><a href="#接入api和picgo协同" class="headerlink" title="接入api和picgo协同"></a>接入api和picgo协同</h2><p><a target="_blank" rel="noopener" href="https://www.shejibiji.com/archives/8411">参考这个博客设置请求</a></p>
<p>但是捏，套了cdn的地址没法在线post,解了cdn之后才发现并不能post ipv6地址……纯ipv6的痛苦</p>
<p>想了想，发现能本地post，命令如下</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">curl localhost:80/api/v1/tokens -X POST -d <span class="hljs-string">&#x27;email=example@example.com&amp;password=yourpass&#x27;</span><br></code></pre></td></tr></table></figure>

<p>可以正常返回<br><img src="https://pic.1314171.xyz/i/2022/10/19/634fe105c8f1c.png" srcset="/img/loading.gif" lazyload alt="成功！这就是我用picgo上传的图片"></p>
<h2 id="发现能用webdav等存储"><a href="#发现能用webdav等存储" class="headerlink" title="发现能用webdav等存储"></a>发现能用webdav等存储</h2><p>还未尝试，TODO:</p>
<h2 id="其他问题，http图床链接在vscode中无法加载预览解决"><a href="#其他问题，http图床链接在vscode中无法加载预览解决" class="headerlink" title="其他问题，http图床链接在vscode中无法加载预览解决"></a>其他问题，http图床链接在vscode中无法加载预览解决</h2><p>参看如下两篇就明白了</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/wejack/article/details/122309967?spm=1001.2101.3001.6650.5&utm_medium=distribute.pc_relevant.none-task-blog-2~default~OPENSEARCH~Rate-5-122309967-blog-105007956.pc_relevant_aa_2&depth_1-utm_source=distribute.pc_relevant.none-task-blog-2~default~OPENSEARCH~Rate-5-122309967-blog-105007956.pc_relevant_aa_2&utm_relevant_index=6">markdown预览</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_41821678/article/details/105007956">加载http链接</a></p>
<blockquote>
<p>本篇博客所有图片均上传在新部署的图床上</p>
</blockquote>
<blockquote>
<p>目前图床关闭注册以及游客上传功能，没有公开计划，如有需要请联系我</p>
</blockquote>
<h1 id="其他友情链接"><a href="#其他友情链接" class="headerlink" title="其他友情链接"></a>其他友情链接</h1><h2 id="nginx"><a href="#nginx" class="headerlink" title="nginx"></a>nginx</h2><p><a target="_blank" rel="noopener" href="https://www.myfreax.com/how-to-install-nginx-on-debian-10/">教程1</a></p>
<p><a target="_blank" rel="noopener" href="https://www.myfreax.com/nginx-commands-you-should-know/">教程2</a></p>
<h2 id="PHP"><a href="#PHP" class="headerlink" title="PHP"></a>PHP</h2><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/Time888/article/details/113935083">PHP教程</a></p>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/%E6%95%99%E7%A8%8B/" class="category-chain-item">教程</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/vscode/">#vscode</a>
      
        <a href="/tags/blog/">#blog</a>
      
        <a href="/tags/vps/">#vps</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>用仅ipv6vps自建图床并支持ipv4访问</div>
      <div>http://blog.1314171.xyz/post/220904picture-server.html</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>TT2TER</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2022年9月5日</div>
        </div>
      
      
      <div class="license-meta-item">
        <div>许可协议</div>
        <div>
          
            
            
              <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/">
              <span class="hint--top hint--rounded" aria-label="BY - 署名">
                <i class="iconfont icon-by"></i>
              </span>
              </a>
            
              <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/">
              <span class="hint--top hint--rounded" aria-label="SA - 相同方式共享">
                <i class="iconfont icon-sa"></i>
              </span>
              </a>
            
          
        </div>
      </div>
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/post/220928stablediffusioninstall.html" title="最近大火的stable-diffusion（AI画图模型）安装">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">最近大火的stable-diffusion（AI画图模型）安装</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/post/220903picture-server.html" title="尝试新的图床解决方案">
                        <span class="hidden-mobile">尝试新的图床解决方案</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
  <article id="comments" lazyload>
    
  <div id="waline"></div>
  <script type="text/javascript">
    Fluid.utils.loadComments('#waline', function() {
      Fluid.utils.createCssLink('https://lib.baomitu.com/waline/2.5.1/waline.min.css')
      Fluid.utils.createScript('https://lib.baomitu.com/waline/2.5.1/waline.min.js', function() {
        var options = Object.assign(
          {"serverURL":"https://commentserver.1314171.xyz/","path":"window.location.pathname","meta":["nick","mail","link"],"requiredMeta":["nick"],"lang":"zh-CN","emoji":["//unpkg.com/@waline/emojis@1.0.1/bilibili","//unpkg.com/@waline/emojis@1.0.1/weibo","//unpkg.com/@waline/emojis@1.0.1/tw-emoji"],"dark":"html[data-user-color-scheme=\"dark\"]","wordLimit":0,"pageSize":10,"placeholder":null,"avatar":"retro","avatarCDN":"https://seccdn.libravatar.org/avatar/","avatarForce":false,"highlight":true},
          {
            el: '#waline',
            path: window.location.pathname
          }
        )
        Waline.init(options);
        Fluid.utils.waitElementVisible('#waline .vcontent', () => {
          var imgSelector = '#waline .vcontent img:not(.vemoji)';
          Fluid.plugins.imageCaption(imgSelector);
          Fluid.plugins.fancyBox(imgSelector);
        })
      });
    });
  </script>
  <noscript>Please enable JavaScript to view the comments</noscript>


  </article>


          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
      <div class="col-lg-7 mx-auto nopadding-x-md">
        <div class="container custom mx-auto">
          _今天是美好的一天_
        </div>
      </div>
    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> <a>|</a> <a href="https://icp.gov.moe/?keyword=20229966" target="_blank">萌ICP备20229966号</a> <br/> <div style="font-size: 0.85rem"> <span id="timeDate">载入天数...</span> <span id="times">载入时分秒...</span> <script src="/js/duration.js"></script> 
    </div>
  
  
    <div class="statistics">
  
  

  
    
      <span id="leancloud-site-pv-container" style="display: none">
        总访问量 
        <span id="leancloud-site-pv"></span>
         次
      </span>
    
    
      <span id="leancloud-site-uv-container" style="display: none">
        总访客数 
        <span id="leancloud-site-uv"></span>
         人
      </span>
    
    

  
</div>

  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.18.2/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      headingSelector : CONFIG.toc.headingSelector || 'h1,h2,h3,h4,h5,h6',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      collapseDepth   : CONFIG.toc.collapseDepth || 0,
      scrollSmooth    : true,
      headingsOffset  : -boardTop
    });
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.10/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script defer src="/js/leancloud.js" ></script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
